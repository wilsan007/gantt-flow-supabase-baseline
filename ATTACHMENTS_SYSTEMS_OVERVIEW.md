# üìé Syst√®mes de Gestion de Fichiers - Vue d'Ensemble

L'application dispose de **DEUX syst√®mes de gestion de fichiers distincts et ind√©pendants**.

---

## üéØ Vue d'Ensemble Rapide

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                   TABLEAU DYNAMIQUE D'EX√âCUTION                         ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ                                                                          ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê‚îÇ
‚îÇ  ‚îÇ   PARTIE     ‚îÇ   PARTIE     ‚îÇ         PARTIE DROITE               ‚îÇ‚îÇ
‚îÇ  ‚îÇ   FIXE       ‚îÇ   GAUCHE     ‚îÇ         (ACTIONS)                   ‚îÇ‚îÇ
‚îÇ  ‚îÇ              ‚îÇ  (COLONNES)  ‚îÇ                                     ‚îÇ‚îÇ
‚îÇ  ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§‚îÇ
‚îÇ  ‚îÇ Titre        ‚îÇ Progression  ‚îÇ Analyse  ‚îÇ Conception ‚îÇ Impl√©m.    ‚îÇ‚îÇ
‚îÇ  ‚îÇ              ‚îÇ              ‚îÇ Besoins  ‚îÇ            ‚îÇ            ‚îÇ‚îÇ
‚îÇ  ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§‚îÇ
‚îÇ  ‚îÇ Ma t√¢che     ‚îÇ [===40%===]  ‚îÇ ‚óã 40% + ‚îÇ  ‚óã 35% +  ‚îÇ ‚úì 25% + (2)‚îÇ‚îÇ
‚îÇ  ‚îÇ              ‚îÇ    + (1)     ‚îÇ         ‚îÇ            ‚îÇ            ‚îÇ‚îÇ
‚îÇ  ‚îÇ              ‚îÇ     ‚Üë        ‚îÇ    ‚Üë        ‚Üë            ‚Üë         ‚îÇ‚îÇ
‚îÇ  ‚îÇ              ‚îÇ  SYST√àME 1   ‚îÇ         SYST√àME 2                  ‚îÇ‚îÇ
‚îÇ  ‚îÇ              ‚îÇ  (T√¢ches)    ‚îÇ    (Actions Op√©rationnelles)       ‚îÇ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

## üìã SYST√àME 1 : Fichiers de T√¢ches

### **üéØ Objectif**
G√©rer les fichiers de preuve **globaux** pour une **t√¢che enti√®re**.

### **üìç Localisation**
- **Colonne** : "Progression" (partie gauche du tableau)
- **Position** : √Ä c√¥t√© de la barre de progression (`[===40%===] + (1)`)

### **üìÅ Fichiers Concern√©s**
- **Migration** : `supabase/migrations/20241026_task_attachments.sql`
- **Composant UI** : `src/components/tasks/TaskAttachmentUpload.tsx`
- **Composant Table** : `src/components/tasks/TaskTableEnterprise.tsx`
- **Table SQL** : `task_attachments`
- **Bucket Storage** : `task-attachments`

### **üîë Caract√©ristiques**
- **1 bouton "+"** par t√¢che
- Compteur global de fichiers de la t√¢che
- Validation : T√¢che non validable sans au moins 1 fichier
- Utilisation : Preuves g√©n√©rales (captures d'√©cran, rapports, etc.)

### **üìä Exemple d'Usage**
```
T√¢che : "Migration Base de Donn√©es"
Progression : [===40%===] + (3)
                           ‚Üë
                    3 fichiers upload√©s :
                    - screenshot_migration.png
                    - rapport_migration.pdf
                    - logs_erreurs.txt
```

### **üí° Cas d'Utilisation**
- Documents g√©n√©raux de la t√¢che
- Captures d'√©cran globales
- Rapports de synth√®se
- Logs d'erreurs
- Fichiers de configuration

---

## üé¨ SYST√àME 2 : Fichiers d'Actions Op√©rationnelles ‚úÖ

### **üéØ Objectif**
G√©rer les fichiers de preuve **sp√©cifiques** pour chaque **action op√©rationnelle**.

### **üìç Localisation**
- **Colonnes** : "Analyse des besoins", "Conception", "Impl√©mentation", etc. (partie droite dynamique)
- **Position** : √Ä c√¥t√© de chaque cercle d'action (`‚óã 40% + (2)`)

### **üìÅ Fichiers Concern√©s**
- **Migration** : `supabase/migrations/20241026_action_attachments.sql`
- **Composant UI** : `src/components/operations/ActionAttachmentUpload.tsx`
- **Composant Table** : `src/components/vues/table/TaskActionColumns.tsx` ‚ö†Ô∏è
- **Table SQL** : `operational_action_attachments`
- **Bucket Storage** : `action-attachments`

### **üîë Caract√©ristiques**
- **1 bouton "+"** par action op√©rationnelle
- Compteur individuel par action
- **Validation STRICTE** : Cercle d√©sactiv√© sans fichier
- **Toast d'erreur** si tentative de validation sans fichier
- Utilisation : Preuves sp√©cifiques par √©tape

### **üìä Exemple d'Usage**
```
T√¢che : "Migration Base de Donn√©es"

Action 1 : "Analyse des besoins" 
  ‚Üí ‚óã 40% + (2)
     - analyse_besoins.pdf
     - sch√©ma_actuel.png

Action 2 : "Conception"
  ‚Üí ‚óã 35% + (1)
     - schema_migration.png

Action 3 : "Impl√©mentation"
  ‚Üí ‚úì 25% + (3) ‚Üê Valid√©e
     - script_migration.sql
     - logs_migration.txt
     - screenshot_resultat.png
```

### **üí° Cas d'Utilisation**
- **Analyse** : Documents d'analyse, sch√©mas
- **Conception** : Maquettes, diagrammes
- **Impl√©mentation** : Code, scripts
- **Tests** : Rapports de tests, captures
- **Protection** : Audits, certifications

### **üîí R√®gle de Validation**
```
SI fichiers_upload√©s = 0:
  ‚ùå Cercle d√©sactiv√© (opacit√© 50%, non cliquable)
  üö® Toast : "Document requis"
  
SI fichiers_upload√©s >= 1:
  ‚úÖ Cercle actif (cliquable)
  ‚úÖ Validation possible
```

---

## üîÑ Comparaison des Deux Syst√®mes

| Aspect | SYST√àME 1 (T√¢ches) | SYST√àME 2 (Actions) |
|--------|-------------------|---------------------|
| **Localisation** | Colonne Progression (gauche) | Colonnes Actions (droite) |
| **Granularit√©** | Par t√¢che (global) | Par action (sp√©cifique) |
| **Nombre de "+"** | 1 par t√¢che | 1 par action (plusieurs par t√¢che) |
| **Table SQL** | `task_attachments` | `operational_action_attachments` |
| **Bucket Storage** | `task-attachments` | `action-attachments` |
| **Composant Upload** | `TaskAttachmentUpload.tsx` | `ActionAttachmentUpload.tsx` |
| **Composant Table** | `TaskTableEnterprise.tsx` | `TaskActionColumns.tsx` |
| **Validation** | Optionnelle | **OBLIGATOIRE** ‚úÖ |
| **Cercle d√©sactiv√©** | Non | **Oui** (sans fichier) |
| **Toast d'erreur** | Non | **Oui** (tentative sans fichier) |
| **Usage** | Preuves g√©n√©rales | Preuves sp√©cifiques par √©tape |

---

## üéØ Quand Utiliser Chaque Syst√®me ?

### **‚úÖ Utiliser SYST√àME 1 (T√¢ches)** si :
- Document concerne **toute la t√¢che**
- Preuve g√©n√©rale (rapport global, synth√®se)
- Pas li√© √† une action sp√©cifique
- Exemple : "Rapport final de migration"

### **‚úÖ Utiliser SYST√àME 2 (Actions)** si :
- Document concerne **une √©tape pr√©cise**
- Preuve sp√©cifique (analyse, conception, test)
- Validation granulaire requise
- Exemple : "Sch√©ma de conception v2.1"

---

## üõ†Ô∏è Architecture Technique

### **Base de Donn√©es**

#### **Table 1 : task_attachments**
```sql
CREATE TABLE task_attachments (
  id UUID PRIMARY KEY,
  tenant_id UUID NOT NULL,
  task_id UUID NOT NULL,         ‚Üê Lien vers la t√¢che
  file_name TEXT NOT NULL,
  storage_path TEXT NOT NULL,
  uploaded_by UUID NOT NULL,
  ...
);
```

#### **Table 2 : operational_action_attachments**
```sql
CREATE TABLE operational_action_attachments (
  id UUID PRIMARY KEY,
  tenant_id UUID NOT NULL,
  action_template_id UUID NOT NULL,  ‚Üê Lien vers l'action
  task_id UUID NOT NULL,              ‚Üê Lien vers la t√¢che
  file_name TEXT NOT NULL,
  storage_path TEXT NOT NULL,
  uploaded_by UUID NOT NULL,
  ...
);
```

### **Diff√©rence Cl√©**
- **Syst√®me 1** : 1 fichier ‚Üí 1 t√¢che
- **Syst√®me 2** : 1 fichier ‚Üí 1 action + 1 t√¢che (plus granulaire)

---

## üìä Workflow Complet

### **√âtape 1 : Cr√©er une T√¢che**
```
T√¢che : "D√©velopper API REST"
```

### **√âtape 2 : Ajouter des Actions Op√©rationnelles**
```
Action 1 : Analyse des besoins (40%)
Action 2 : Conception (35%)
Action 3 : Impl√©mentation (25%)
```

### **√âtape 3 : Uploader des Fichiers d'Actions (SYST√àME 2)**
```
Action 1 : ‚óã 40% + (2) ‚Üê 2 fichiers sp√©cifiques
Action 2 : ‚óã 35% + (1) ‚Üê 1 fichier sp√©cifique
Action 3 : ‚óã 25% +     ‚Üê Aucun fichier (cercle d√©sactiv√© ‚ùå)
```

### **√âtape 4 : Valider les Actions**
```
Action 1 : ‚úì 40% + (2) ‚Üê Valid√©e
Action 2 : ‚úì 35% + (1) ‚Üê Valid√©e
Action 3 : ‚óã 25% +     ‚Üê Non validable (pas de fichier)
```

### **√âtape 5 : Uploader des Fichiers de T√¢che (SYST√àME 1)**
```
Progression : [===75%===] + (3) ‚Üê 3 fichiers globaux
```

### **√âtape 6 : Valider la T√¢che**
```
T√¢che compl√®te : ‚úì 100%
Toutes les actions valid√©es
Fichiers globaux upload√©s
```

---

## ‚úÖ Checklist D√©veloppeur

### **Pour SYST√àME 1 (T√¢ches)**
- [ ] Migration `20241026_task_attachments.sql` appliqu√©e
- [ ] Bucket `task-attachments` cr√©√© (priv√©)
- [ ] Composant `TaskAttachmentUpload.tsx` fonctionnel
- [ ] Bouton "+" visible dans colonne Progression
- [ ] Compteur s'affiche correctement

### **Pour SYST√àME 2 (Actions)** ‚úÖ
- [ ] Migration `20241026_action_attachments.sql` appliqu√©e
- [ ] Bucket `action-attachments` cr√©√© (priv√©)
- [ ] Composant `ActionAttachmentUpload.tsx` fonctionnel
- [ ] Bouton "+" visible √† c√¥t√© de chaque cercle
- [ ] Compteur s'affiche correctement
- [ ] **Cercle d√©sactiv√© sans fichier** ‚úÖ
- [ ] **Toast d'erreur si tentative sans fichier** ‚úÖ
- [ ] Validation strictement bloqu√©e ‚úÖ

---

## üöÄ Commandes de Test

### **1. Appliquer les Migrations**
```bash
cd supabase
supabase db push
```

### **2. Cr√©er les Buckets Storage**
Dans Supabase Dashboard ‚Üí Storage :
- Cr√©er `task-attachments` (priv√©)
- Cr√©er `action-attachments` (priv√©)

### **3. Tester SYST√àME 1**
1. Ouvrir le tableau
2. Cliquer sur le "+" dans la colonne Progression
3. Uploader un fichier
4. V√©rifier que le compteur s'affiche : `+ (1)`

### **4. Tester SYST√àME 2** ‚úÖ
1. Ouvrir le tableau
2. Essayer de cliquer sur un cercle sans fichier ‚Üí ‚ùå Toast d'erreur
3. Cliquer sur le "+" √† c√¥t√© d'un cercle
4. Uploader un fichier
5. V√©rifier que le compteur s'affiche : `+ (1)`
6. V√©rifier que le cercle est maintenant cliquable ‚úÖ
7. Cliquer sur le cercle ‚Üí Action valid√©e ‚úì

---

## üéâ Conclusion

**Deux syst√®mes compl√©mentaires et ind√©pendants** :

1. **SYST√àME 1 (T√¢ches)** : Preuves globales, optionnelles, colonne gauche
2. **SYST√àME 2 (Actions)** : Preuves sp√©cifiques, **obligatoires**, colonnes droites ‚úÖ

Les deux syst√®mes coexistent sans conflit et offrent une **granularit√© maximale** dans la gestion des preuves de r√©alisation.

---

**Date de documentation** : 27 Octobre 2025  
**Statut** : ‚úÖ **Les deux syst√®mes sont op√©rationnels**  
**Impl√©mentation correcte** : ‚úÖ **SYST√àME 2 au bon endroit (partie droite)** üöÄ
