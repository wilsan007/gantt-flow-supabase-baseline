#!/bin/bash

echo "ğŸš€ DÃ‰PLOIEMENT DES CORRECTIONS EMAIL CONFIRMATION"
echo "================================================="

echo ""
echo "1ï¸âƒ£ RedÃ©ploiement de l'Edge Function avec nouvelle URL..."
supabase functions deploy send-invitation

echo ""
echo "2ï¸âƒ£ VÃ©rification que l'Edge Function handle-email-confirmation existe..."
supabase functions list | grep handle-email-confirmation || echo "âš ï¸ Edge Function handle-email-confirmation non trouvÃ©e"

echo ""
echo "3ï¸âƒ£ RedÃ©marrage du serveur de dÃ©veloppement..."
echo "   ArrÃªtez le serveur actuel (Ctrl+C) puis relancez :"
echo "   npm run dev"

echo ""
echo "âœ… CORRECTIONS DÃ‰PLOYÃ‰ES !"
echo ""
echo "ğŸ”§ PROCHAINES Ã‰TAPES MANUELLES :"
echo "================================"
echo ""
echo "1. CONFIGURER LES URL DANS SUPABASE DASHBOARD :"
echo "   - URL: https://supabase.com/dashboard/project/qliinxtanjdnwxlvnxji"
echo "   - Authentication > URL Configuration"
echo "   - Site URL: http://localhost:8080"
echo "   - Additional Redirect URLs:"
echo "     * http://localhost:8080/auth/callback"
echo "     * http://localhost:8080/dashboard"
echo "     * http://localhost:8080/"
echo ""
echo "2. CONFIGURER LE WEBHOOK (OPTIONNEL) :"
echo "   - Database > Webhooks > Create a new hook"
echo "   - Name: email-confirmation-handler"
echo "   - Table: auth.users"
echo "   - Events: â˜‘ï¸ Update"
echo "   - URL: https://qliinxtanjdnwxlvnxji.supabase.co/functions/v1/handle-email-confirmation"
echo "   - Condition: email_confirmed_at IS NOT NULL"
echo ""
echo "ğŸ¯ NOUVEAU FLUX :"
echo "================"
echo "1. Clic sur lien email â†’ Supabase valide token"
echo "2. Redirection â†’ /auth/callback (nouvelle page)"
echo "3. Page callback â†’ Attend webhook + redirige dashboard"
echo "4. Processus fluide et automatique !"
echo ""
